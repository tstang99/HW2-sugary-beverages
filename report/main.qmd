---
title: "What is the best way to promote zero calories beverages?"
format: 
  pdf:
    fontsize: 11pt
editor: visual
bibliography: ../reference/reference.bib
author: Ivy Liu, Zefan Liu, Tom Tang
---

## Introduction

Zero calorie beverages are healthier compared to sugared beverages because they contain less sugar and significantly fewer calories. Over the past decades, hospitals have been striving to promote zero-calorie beverages for a healthier lifestyle. This study employs five interventions to help increase such promotion. These interventions include a 10% price discount, a price discount combined with messaging that explains the reason for the discount, messaging displaying the caloric content in sugared beverages, messaging indicating the amount of exercise needed to burn off the calories in a sugared beverage, and messaging containing both caloric content and the amount of physical activity needed.

The study aims to investigate whether these interventions help encourage people to choose zero calorie beverages over sugared beverages and if such effects varies across hospitals.

## Data description and summaries

This is an experimental design where data are collected over 30 weeks, from October 27 to May 23, with a follow-up period of 14 days, gathered from two urban hospitals and one suburban hospital. During this time period, the sales of different types of drinks are recorded (see Table \ref{tab1}).

```{=tex}
\begin{table}[htbp]
    \centering
    \caption{Summary of data}
    \label{tab1}
    \begin{tabular}{ c|c|c }
        \hline
        Data Name & Data Type & Data Description \\
        \hline
        Count        & Categorical & The day from the beginning of study
        DofW         & Categorical & The day of the week, 7 levels \\
        Site         & Categorical & The location of the hospital, 3 levels \\
        Intervention & Categorical & The intervention applied, 9 levels \\
        ZeroCal      & Integer     & The number of zero calorie drinks sold \\
        Sugary       & Integer     & The number of sugary drinks sold \\
        Juice100     & Integer     & The number of Juice100 sold \\
        Ojuice       & Integer     & The number of Ojuice sold \\
        Sports       & Integer     & The number of sports drinks sold \\
        Total        & Continuous  & The sum of all drinks sold \\
        \hline
    \end{tabular}
\end{table}
```
There are missing entries in this dataset, with a significant portion of the missing data attributed to the 'Juice100,' 'Ojuice,' and 'Sports' columns. Since neither these measurements themselves nor their links with the consumption of ZeroCal/Sugary beverages are the main focus of the study, the missing values in these columns should not be given specific attention. Additionally, there are seven entirely missing consecutive entries at HF hospital during the follow-up period and two isolated cases of missing entries. Such occurrences could be due to public holidays or temporary closures for renovation. In general, such missing data can be classified as missing at random.

## Exploratory Data Analysis

```{r, include=FALSE}
library(here)
library(readr)
library(dplyr)
data <- read_csv(here("rawdata/june1data.csv"))
data <- filter(data, Total > 0) 
data <- data[,-c(7,8,9)]
```

Firstly, to address the influence of location on zero-calorie beverage consumption, which is of primary interest to the study, a spaghetti plot is recommended. A spaghetti plot is typically used to demonstrate the change of multiple flows over time and how they vary across the three sites. Based on Figure 1, it is evident that the time-series data for zero-calorie beverage consumption at the site "chop" are significantly higher than those at the other two sites, suggesting substantial variation in consumption distributions under different interventions. Additionally, the spaghetti plot reveals that except for the initial period at the site "HF," there is no apparent trend at all three sites, as the long-term averages seem to be stable. However, strong weekly variations are evident, implying that it is reasonable to include the day of the week (DofW) and exclude the time (count) in the model.

```{r figs, echo=FALSE, fig.width=7,fig.height=4,fig.cap="\\label{fig:figs}Examples of Recommended EDA Plots"}
library(ggplot2)
library(cowplot)
ggplot(data=data, aes(x=Count, y=ZeroCal, color=Site))+
  geom_point()+
  geom_line()+
  labs(x="Days of Experiment", y="ZeroCal (bottle)",
       title="The Spaghetti Plot")+
  theme(plot.title=element_text(hjust=0.5),
        legend.position="bottom")

```

## Formal analysis

It is recommended to implement a Generalized Linear Mixed Model (GLMM) to address the problems. A GLMM, an extension of the Linear Mixed Model (LMM) [@winter2013linear], can incorporate both fixed and random effects, and also accommodate the response variable being a count variable through a link function [@dobson2018introduction]. Specifically, while the fixed effects assess the association of covariates with the response variable across the overall population---serving as a baseline---the random effects account for variations in some associations across different entities or individuals. Link function can guarantee that the range of model outputs matches with the range of values that can be observed, which is the advantage of GLMM over LMM.

In this study, our primary aim is to examine the impacts of various interventions. Hence, it is advisable to consider the intervention variable as a fixed effect. Furthermore, the Day of Week (DofW) should be treated as fixed effects too, since they are consistent across all three sites. The random effect in this analysis should be the Site, which accounts for variability in the observations over time. Although the total consumption volume is a plausible predictor for both variables of interest—zero-calorie and sugary beverage consumption—it is more fitting to incorporate it as an offset term in the model. This approach ensures that its influence on the model is "structural," with a fixed coefficient of one, reflecting its proportional effect on the response variables.

Given that the consumption data consist of non-negative integers, a logical choice for the link function is the logarithm transformation applied to the ZeroCal, Sugary, and Total variables. This transformation ensures that the model's outputs remain positive, aligning with the nature of the consumption data.

Hence, the proposed models are

```{=tex}
\begin{align*}
\log(\text{ZeroCal}_{ij}) &= (\beta_0+b_i) + \beta_1\text{Intervention} + \beta_2\text{DofW} + \text{offset}(\log(\text{Total}))\\
\log(\text{Sugary}_{ij}) &= (\beta_0+b_i) + \beta_1\text{Intervention} + \beta_2\text{DofW} + \text{offset}(\log(\text{Total}))
\end{align*}
```
where $b_i \sim N(0,\sigma^2)$ represents the random effect from Site. Note that response variables, which are counts, can be assumed to follow either Poisson or Negative Binomial distribution under log link function. The former is more common but also more restrictive.

```{r, include=FALSE}
library(lme4)
library(glmmTMB)
data$Site <- as.factor(data$Site)
data$Intervention <- as.factor(data$Intervention)
data$Intervention <- relevel(data$Intervention, 
                             ref = "preint")
data$DofW <- as.factor(data$DofW)

zerocal_lme = glmer(ZeroCal ~ (1|Site) + Intervention 
                    + DofW + offset(log(Total)), data=data, family=poisson)
zerocal_lme_nb = glmmTMB(ZeroCal ~ (1|Site) + offset(log(Total)) + Intervention 
                        + DofW, data=data, family=nbinom1)
AIC(zerocal_lme)
AIC(zerocal_lme_nb)

sugary_lme = glmer(Sugary ~ (1|Site) + offset(log(Total)) + Intervention 
                    + DofW, data=data, family=poisson)
sugary_lme_nb = glmmTMB(Sugary ~ (1|Site) + offset(log(Total)) + Intervention 
                        + DofW, data=data, family=nbinom1)
AIC(sugary_lme)
AIC(sugary_lme_nb)
```

Based on our analysis, the Generalized Mixed Effect Models with the assumption that the response variables follow a negative binomial distribution outperform other models in terms of the Akaike Information Criterion (AIC), a widely used criterion for model selection. For zero-calorie beverage consumption, the model indicates that only the "discount+messaging" intervention has a statistically significant effect. Similarly, for sugary beverage consumption, the effect of the "discount+messaging" intervention is also significant. Additionally, the effects associated with "DofW=6" (Saturday) and "DofW=7" (Sunday) are significant, suggesting that, on average, sugary beverage consumption may vary between weekdays and weekends.

## Conclusions

Overall, to assess the impact of various interventions on the consumption of zero-calorie and sugary beverages, while accounting for site effects, we propose utilizing a generalized mixed-effects model with a negative binomial distribution assumption for both variables of interest. According to the model outputs, the "discount+messaging" intervention consistently shows statistical significance. Additionally, the effects associated with "DofW=6" (Day of Week = Saturday) and "DofW=7" (Day of Week = Sunday) are significant only in the models concerning sugary beverage consumption. Therefore, to enhance zero-calorie beverage intake, we recommend implementing a strategy that combines discounts with explicit messaging to customers. By including the total beverage consumption as an offset in our analysis, we observe that the day of the week typically does not exert a significant influence on the response variables. For more detailed insights, please refer to the statistical appendix.

## References

::: {#refs}
:::

## Statistical Appendix

### Mathematical Formulation of Models

Here is a formulation of the Generalized Linear Mixed Model within the context of this research. As suggested earlier, random effects can be placed on both the intervention's slope and intercept. Taking $y = ZeroCal, x_1 = Total, x_2 = Intervention, x_3 = DofW$, the model will take the format of

```{=tex}
\begin{equation}
\label{eq1}
E(y_{ij}) = exp((\beta_0 + b_{0i}) + (\beta_1 + b_{1i} + b_1 x_1)\; x_2 + \beta_2 \; x_3 + \beta_3 \; x_1)
\end{equation}
```
where $b_{0i} \sim N(0,\sigma_1^2)$, $b_{1i} \sim N(0,\sigma_2^2)$ and $b_{1} \sim N(0,\sigma_3^2)$. Here, $i \in \{1,2,3\}$ is used to index the three sites, and $j\in \{1,2, \dots, 221\}$ is used to index the date. $\sigma_1$, $\sigma_2$ and $\sigma_3$ can be estimated using data, and $zero\_calorie_{ij}$ is assumed to have poisson distribution where its expectation should be equal to its variance. When such an assumption is violated, usually quasi-maximum likelihood estimation is used. This method estimates the regression parameters without the need to specify a distribution for the outcome. When such an assumption is violated, usually quasi-maximum likelihood estimation is used. This method estimates the regression parameters without the need to specify a distribution for the outcome.
